<html>

<head>
	<meta charset="utf-8">
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<title>jFinder - use machine learning to find out how Jewish you look!</title>
	<script src="https://code.jquery.com/jquery-3.3.1.min.js"></script>
	<script src="Build/UnityLoader.js"></script>
	<!--	<script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.form/4.2.2/jquery.form.min.js"></script>-->
	<link rel="stylesheet" href="style.css">
</head>

<body>
	<div id="head">
		<div class="product-name">jFinder</div><br>use A.I to find out how Jewish you look!
		<!--<br><span class="astrix">*</span><span id="title-dev">in development</span>-->
	</div>
	<div id="loading-screen">
		<img id="loading-logo" src="images/loading.gif">
	</div>
	<div id="content">

		<button id="webgl" class="hide-input" onclick="runWebgl()"> </button>
		<label for="webgl">Try live</label>
		<div id="webgl-container">
			<div id="loading-webgl">
				<img src="images/loading.gif" id="webgl-loader">Loading, <br> Make sure you have your webcam connected and to allow the site to use it.<br> (takes about 30 seconds)
			</div>

			<button id="stop-button" onclick="location.reload()">stop</button>
			<div id="h3-container">
				<h1>See how Jewish you look:</h1>
			</div>
			<div id="gameContainer" style="width: 640px; height: 480px; "></div>

		</div>
		<div id="mobile-notice">
			("Photo Booth" version is available on desktop)</div>
		<br>
		<hr>
		<div id="upload">
			<h3>Use your camera or choose an image:</h3>

			<div class="upload-container">
				<div id="file-upload" class="disabledElement">
					<form id="frmUploader" enctype="multipart/form-data" action="http://localhost:3003/upload" method="post">

						<input type="file" name="file" id="file" class="hide-input hide-data" />
						<label for="file">Choose image</label>
						<br><br>
						<button type="submit" name="submit" id="btnSubmit" value="upload">Get prediction</button>
					</form>
				</div>
			</div>
			<div id="result-container">
				<img src="" id="result"></div>
		</div>
		<hr>
		<div class="process">
			<img src="images/img_29_10_2018_21_14_664_printul-harry-si-meghan-markle.jpg"><br>
			<div id="blurb">
				jFinder, is an artifitial neural net that predicts whether someone is jewish based on their facial features.</div>
			<span>With 91.08% accuracy<br><br>(tested on 1500 samples, trained on over 5000 images).</span><br><br>
		</div>
		<hr>
		<div class="process">

			<h1 class="section-margin title">The process</h1>

			<h2 class="mini-title">Aggregating faces to compose a jewish/non-Jewish database.
</h2>

			<h2>Samples from the Jewish sources:</h2>

			<img src="images/9-46.jpg"><br>
			<div class="center italic">circa 1990, Jewish immigrants from the Soviet Union</div>
			<img src="images/D9FF.jpg"><br>
			<div class="center italic">Jewish refugees, Europe (probably Italy), January 1944</div>
			<img src="images/-PM.jpeg"><br>
			<div class="center italic">Israeli president Reuven Rivlin with ultra-Orthodox IDF soldiers</div>

			<img src="images/908+.JPG"><br>
			<div class="center italic">Alliance School in Baghdad, 1908 (courtesy Ezra Hakkak) </div>
			<img src="images/tzva_.jpg"><br>
			<div class="center italic">Egyptian Jews in Alexandria when the community was more numerous. Photograph: Nebi Daniel Association</div>
			<img src="images/003.jpeg"><br>
			<div class="center italic"></div>
			<img src="images/1989.jpg"><br>
			<div class="center italic">
			Kiryat-Sharet high school, Holon. 1989 yearbook. 
			</div>
			<img src="images/2834.JPG"><br>
			<div class="center italic">
			"Yesh Atid" political party's PR delegation to Germany, 26th June 2017. (photo: Aliza Lavy).
			</div>
			<img src="images/52_n.jpg"><br>
			<div class="center italic">
			"HaNoar HaOved" youth camp. Acre.</div>
			<img src="images/8598.JPG"><br>
			<div class="center italic">
			Ultra Orthodox IDF soldiers.</div>
			<img src="images/a-40.jpg"><br>
			<div class="center italic">
			"Tikun Olam", "Bina" Volunteering activities.</div>
			<img src="images/e213.jpg"><br>
			<div class="center italic">
			Jewish Young Girls welcoming the israeli British Army soldiers, Libya. Circa 1942.</div>
			<img src="images/FA00.jpg"><br>
			<div class="center italic">
			</div>
			<h3 class="section-margin">Samples of Non-Jewish sources</h3>

			<img src="images/non-jewish/1920.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/2007.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/2014.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/2018.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/2998.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/6-AM.png"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/9716.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/_n-1.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/a9bb.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/ader.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/ault.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/Bali.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/cial.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/es-1.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/f0c6.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/ican.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/move.jpg"><br>
			<div class="center italic">
			</div>
			<img src="images/non-jewish/rk.0.jpg"><br>
			<div class="center italic"></div>
			<img src="images/non-jewish/sity.jpg"><br>
			<div class="center italic"></div>
			<img src="images/non-jewish/slim.jpg"><br>
			<div class="center italic"></div>
			<img src="images/non-jewish/uism.jpg"><br>
			<div class="center italic"></div>
			<img src="images/non-jewish/ukou.jpg"><br>
			<div class="center italic"></div>
			<img src="images/non-jewish/x800.jpg"><br>
			<div class="center italic"></div>
			<img src="images/non-jewish/za01.JPG"><br>
			<div class="center italic"></div>
			<img src="images/non-jewish/zers.jpg"><br>
			<div class="center italic"></div>
			
			<h2 class="section-margin">Into a faces data base</h2>
			<h3>Jewish batch sample</h3><br>
			<img src="images/jewish-batch.png"><br>
			<h3>Non-Jewish batch sample</h3><br>
			<img src="images/gentile-batch.png"><br>

			<h2>Training the model</h2>
			<div class="text">
				A Deep Neural Net was designed specifically for this purpose, according to the data and learning result. The model is based roughly on two award winning models, the VGG16, GoogLeNet, and ResNet.<br><br> The database is composed of roughly 5000 training images and 1500 testing images. After the last session of training (72 hours) this model can classify people according to whether they are Jewish or not in 91.08% accuracy (tested by 1000 images that the model did not see before).<br><br> Below are some visual samples of the data in between the layers. In the process each images is entered as input, each layer manipulates the data in the images and reshapes it, from 224 pixels at the start, to only two pixels, Jewish and non-Jewish, in which their values represent the confidence level of the prediction.
			</div>
			<div id="layers">
				<h2>Model Layers - Deep Neural Net</h2>
				<span class='text'>Samples from a few of the layers:</span>

				<h3>Input image</h3>
				<span class='text'>224 pixels X 224 pixels</span><br>
				<img style="width:224px;" src="images/intermidiate-layers/layer1.jpg"><br>
				<img class="arrow-down" src="images/arrow-down.jpg">

				<h3>Convolutional layer </h3>
				<span class='text'>Extracting and enhancing values in the image, the image is reshaped according to 32 filters</span><br>
				<img style="width:100%;" src="images/intermidiate-layers/layer2.jpg"><br>
				<img class="arrow-down" src="images/arrow-down.jpg">


				<h3>Max pooling layer </h3>
				<span class='text'>contracting the image and using the highest values of areas</span><br>
				<img style="width:75%;" src="images/intermidiate-layers/layer3.jpg"><br>
				<img class="arrow-down" src="images/arrow-down.jpg">


				<h3>Convolutional layer </h3>
				<img style="width:50%;" src="images/intermidiate-layers/layer5.jpg"><br>
				<img class="arrow-down" src="images/arrow-down.jpg">

				<h3>reshape layer </h3>
				<span class='text'>A multidimentional pattern that we'll start to narrow down and flatten down.</span><br>
				<img style="width:500px;" src="images/intermidiate-layers/layer6.jpg"><br>
				<img class="arrow-down" src="images/arrow-down.jpg">

				<h3>Flatten </h3>
				<span class='text'>One long line of pixels (values).</span>
				<img style="width:100%;" src="images/intermidiate-layers/layer7.jpg"><br>
				<img class="arrow-down" src="images/arrow-down.jpg">

				<h3>Final output </h3>
				<span class='text'>Two pixels, each represent a classification (Jewish and Now-Jewish) with values that represent the models confidence.</span><br>
				<img style="width:30px;" src="images/intermidiate-layers/layer8.jpg"><br>

			</div>
		</div>

		<hr>
		<div class="process">
			<h2 class="section-margin">Some obvious Predictions</h2>
			<!--<img src="images/prediction/me.png"><br>-->
			<img class='mobile-img' src="images/me-jewish.jpg"><br>

			<img src="images/prediction/both.png"><br>

			<img src="images/prediction/nationalist.png"><br>

			<img src="images/prediction/University-White-Nationalists-1-1532227089.jpg"><br>

			<img src="images/prediction/hesus.png"><br>

			<img src="images/prediction/trump.png"><br>



		</div>

		<div id="footer">
			more info at <a href="https://ronerlihstudio.com">ronelihstudio.com</a>
		</div>
	</div>
	<script>
		$(function() {

			let usingChrome = isChrome();
			let isMobile = mobileCheck();
			usingChrome ? console.log("usingChrome: " + usingChrome) : noChromeStyle(isMobile);

			const fileSelect = document.getElementById('file');
			const loadingScreen = $('#loading-screen');

			$('#frmUploader').submit((e) => {

				e.stopPropagation();
				e.preventDefault();
				loadingScreen.fadeIn();
				var $form = $(this);
				var file = fileSelect.files[0];
				var formData = new FormData();
				formData.append('img', file, file.name);
				//	 
				//    $.post('/upload', $this.serialize(), function (responseData) {
				//		 console.log("response:");
				//		 console.log(responseData);
				//	 });

				var xhr = new XMLHttpRequest();
				xhr.open('POST', '/upload', true);

				xhr.onload = function() {
					if (xhr.status === 200) {
						// File(s) uploaded.
						//			 uploadButton.innerHTML = 'Upload';

					} else {
						alert('An error occurred!');
						console.log("err " + JSON.stringify(err, null, 2));
					}
				};

				xhr.send(formData);

				xhr.onreadystatechange = function() {
					if (xhr.readyState === 4) {
						console.log("image name " + xhr.response);
						showResult(xhr.response);
						loadingScreen.fadeOut();
					}
				}
				//	$.ajax({
				//	 	url : 'https://j-finder.com/upload', 
				//		  cache : false,
				//		  method: 'post',
				//        dataType : 'file',
				//		  cache : false,
				//		  headers: { "cache-control": "no-cache" },
				//        success : function (response) {
				//            console.log("image name " + response);
				//				showResult(response);
				//        },
				//		  error: (err)=>{console.log("err " + JSON.stringify(err,null,2));}
				//    });
				return false;
			});

			$('.hide-data').one('click', (e) => {
				e.target.style.width = 580
			});

		});

		function showResult(imgName) {
			res = document.getElementById("result");
			res.src = 'https://j-finder.com/uploads/' + imgName;
			res.style.width = 900;
			res.style.maxWidth = '95vw';
			res.style.border = '4px solid black';
			res.style.marginBottom = 80;
		}

		function runWebgl() {
			var gameInstance = UnityLoader.instantiate("gameContainer", "Build/jFinder.json");
			$('#webgl-container').show();
			$('#webgl').hide();

		}

		function doneLoadingWebgl() {
			console.log('\n\nwebgl load done');
			$('#loading-webgl').hide();
			
		}
		
		function noCamera(){
		$('#loading-webgl').html('No Camera found, or not allowed,<br>Please make sure you have your camera connected and hit refresh.');
		$('#gameContainer').hide();
		$('#h3-container').hide();
		$('#stop-button').html('Refresh')
		}
		function noChromeStyle(mobile) {
			//desktop browsers - not chrome
			console.log("no chrome style called");
			$('html').css('letterSpacing', '-0.7px');
			$('#head').css({
				"letterSpacing": "-1.4px",
				"font-size": "35px"
			});
			$('.product-name').css('fontSize', '40px');

			//mobile safari, firefox, ie, opera..
			if (mobile) {
				$('#mobile-notice, span').css('fontSize', '2em');
				$('#head').css({
					"letterSpacing": "-1.4px",
					"font-size": "4em"
				});
				$('h3').css("font-size", "2.5em");
				$('h2').css("font-size", "3em");
				$('h1').css("font-size", "4em");
				$('.mini-title, .italic').css('fontSize', '2.2em');
				$('.text').css('fontSize', '1.8em');
				$('.product-name').css('fontSize', '70px');

			}

		}

		function mobileCheck() {
			var check = false;
			(function(a) {
				if (/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|iris|kindle|lge |maemo|midp|mmp|mobile.+firefox|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows ce|xda|xiino/i.test(a) || /1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(a.substr(0, 4))) check = true;
			})(navigator.userAgent || navigator.vendor || window.opera);
			return check;
		}

		function isChrome() {
			// please note, 
			// that IE11 now returns undefined again for window.chrome
			// and new Opera 30 outputs true for window.chrome
			// but needs to check if window.opr is not undefined
			// and new IE Edge outputs to true now for window.chrome
			// and if not iOS Chrome check
			// so use the below updated condition
			var isChromium = window.chrome;
			var winNav = window.navigator;
			var vendorName = winNav.vendor;
			var isOpera = typeof window.opr !== "undefined";
			var isIEedge = winNav.userAgent.indexOf("Edge") > -1;
			var isIOSChrome = winNav.userAgent.match("CriOS");

			if (isIOSChrome) {
				// is Google Chrome on IOS
			} else if (
				isChromium !== null &&
				typeof isChromium !== "undefined" &&
				vendorName === "Google Inc." &&
				isOpera === false &&
				isIEedge === false
			) {
				// is Google Chrome
				return true;
			} else {
				// not Google Chrome 
				return false;
			}

		}

	</script>
</body>

</html>
